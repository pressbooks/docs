<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pressbooks CAS Single Sign-On | Pressbooks Documentation</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" type="image/svg+xml" href="/icon.svg">
    <meta name="description" content="User and Developer Documentation">
    
    <link rel="preload" href="/assets/css/0.styles.b8531dc7.css" as="style"><link rel="preload" href="/assets/js/app.05922f2d.js" as="script"><link rel="preload" href="/assets/js/2.6bc8cb11.js" as="script"><link rel="preload" href="/assets/js/8.32271d86.js" as="script"><link rel="prefetch" href="/assets/js/10.4a91acba.js"><link rel="prefetch" href="/assets/js/11.b3821d89.js"><link rel="prefetch" href="/assets/js/12.bebb1d4a.js"><link rel="prefetch" href="/assets/js/13.df0f8169.js"><link rel="prefetch" href="/assets/js/14.b626ca75.js"><link rel="prefetch" href="/assets/js/15.8a07722a.js"><link rel="prefetch" href="/assets/js/16.10fe115f.js"><link rel="prefetch" href="/assets/js/17.d9b03982.js"><link rel="prefetch" href="/assets/js/18.13fa5301.js"><link rel="prefetch" href="/assets/js/19.5b04bcec.js"><link rel="prefetch" href="/assets/js/20.6fb614b7.js"><link rel="prefetch" href="/assets/js/21.6b8b31ab.js"><link rel="prefetch" href="/assets/js/22.2da197b5.js"><link rel="prefetch" href="/assets/js/23.37acd995.js"><link rel="prefetch" href="/assets/js/24.a6817149.js"><link rel="prefetch" href="/assets/js/25.0e72f4f9.js"><link rel="prefetch" href="/assets/js/26.ddf81e5b.js"><link rel="prefetch" href="/assets/js/3.557dccde.js"><link rel="prefetch" href="/assets/js/4.e05c873c.js"><link rel="prefetch" href="/assets/js/5.f3e6ed41.js"><link rel="prefetch" href="/assets/js/6.498ab014.js"><link rel="prefetch" href="/assets/js/7.1fe1ee85.js"><link rel="prefetch" href="/assets/js/9.a7b039b3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b8531dc7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Pressbooks Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="User Guides" class="dropdown-title"><span class="title">User Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="User Guides" class="mobile-dropdown-title"><span class="title">User Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/installation/" class="nav-link">
  Installation
</a></li><li class="dropdown-item"><!----> <a href="/integrations/" class="nav-link router-link-active">
  Integrations
</a></li><li class="dropdown-item"><!----> <a href="/debugging/" class="nav-link">
  Debugging
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Developer Guides" class="dropdown-title"><span class="title">Developer Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Developer Guides" class="mobile-dropdown-title"><span class="title">Developer Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding-standards/" class="nav-link">
  Coding Standards
</a></li><li class="dropdown-item"><!----> <a href="/local-development/" class="nav-link">
  Local Development
</a></li><li class="dropdown-item"><!----> <a href="/workflow/" class="nav-link">
  Workflow
</a></li><li class="dropdown-item"><!----> <a href="/theme-development/" class="nav-link">
  Theme Development
</a></li><li class="dropdown-item"><!----> <a href="/unit-testing/" class="nav-link">
  Unit Testing
</a></li></ul></div></div><div class="nav-item"><a href="/rest-api/" class="nav-link">
  REST API
</a></div><div class="nav-item"><a href="/changelogs/" class="nav-link">
  Changelogs
</a></div><div class="nav-item"><a href="/contributors/" class="nav-link">
  Contributors
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="User Guides" class="dropdown-title"><span class="title">User Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="User Guides" class="mobile-dropdown-title"><span class="title">User Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/installation/" class="nav-link">
  Installation
</a></li><li class="dropdown-item"><!----> <a href="/integrations/" class="nav-link router-link-active">
  Integrations
</a></li><li class="dropdown-item"><!----> <a href="/debugging/" class="nav-link">
  Debugging
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Developer Guides" class="dropdown-title"><span class="title">Developer Guides</span> <span class="arrow down"></span></button> <button type="button" aria-label="Developer Guides" class="mobile-dropdown-title"><span class="title">Developer Guides</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/coding-standards/" class="nav-link">
  Coding Standards
</a></li><li class="dropdown-item"><!----> <a href="/local-development/" class="nav-link">
  Local Development
</a></li><li class="dropdown-item"><!----> <a href="/workflow/" class="nav-link">
  Workflow
</a></li><li class="dropdown-item"><!----> <a href="/theme-development/" class="nav-link">
  Theme Development
</a></li><li class="dropdown-item"><!----> <a href="/unit-testing/" class="nav-link">
  Unit Testing
</a></li></ul></div></div><div class="nav-item"><a href="/rest-api/" class="nav-link">
  REST API
</a></div><div class="nav-item"><a href="/changelogs/" class="nav-link">
  Changelogs
</a></div><div class="nav-item"><a href="/contributors/" class="nav-link">
  Contributors
</a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><p><strong>Table of Contents</strong></p> <ul><li><a href="#installation-activation">Installation / Activation</a></li> <li><a href="#admin-interface-description">Admin interface description</a></li> <li><a href="#details-of-settings-behaviours">Details of settings behaviours</a></li> <li><a href="#user-identification-mechanism">User identification mechanism</a></li></ul> <p>This documentation is up to date as of version 1.x of the Pressbooks CAS Single Sign-on plugin.</p> <h2 id="installation-activation"><a href="#installation-activation" class="header-anchor">#</a> Installation / Activation</h2> <p>Get the plugin here: https://github.com/pressbooks/pressbooks-cas-sso</p> <p>The CAS SSO plugin is installed and activated on the network level.</p> <h2 id="admin-interface-description"><a href="#admin-interface-description" class="header-anchor">#</a> Admin interface description</h2> <p>Upon activation of the plugin, a submenu item (“CAS”) is added to the Network Admin interface under “Integrations”. This leads to the CAS settings page:</p> <p>[caption id=&quot;attachment_483&quot; align=&quot;aligncenter&quot; width=&quot;248&quot;]<a href="https://pressbooks.org/app/uploads/sites/2/2018/06/cas-settings.png" target="_blank" rel="noopener noreferrer"><img src="https://pressbooks.org/app/uploads/sites/2/2018/06/cas-settings-248x300.png" alt="Screenshot of the CAS settings page"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Click to enlarge[/caption]</p> <h2 id="required-settings"><a href="#required-settings" class="header-anchor">#</a> Required Settings:</h2> <p>To configure CAS:</p> <ul><li>CAS Version: 1, 2 or 3</li> <li>Server Hostname</li> <li>Server Port</li> <li>Server Path</li></ul> <p>Decide the response if the CAS user does not have a Pressbooks account:</p> <ul><li>Refuse Access OR Add New User</li></ul> <p><strong>Note</strong>: If the Network Setting for &quot;Allow New Registrations&quot; is set to &quot;No Registrations Allowed&quot;, the CAS &quot;Add New User&quot; setting will bypass the Network Settings and register new users. For detailed behaviour on new user handling, see the section <strong><a href="#add-new-user-refuse-access-behaviour">Details of settings behaviour: Add New user / Refuse access behaviour</a></strong> below.</p> <h2 id="optional-settings"><a href="#optional-settings" class="header-anchor">#</a> Optional settings:</h2> <ul><li><strong>Email Domain</strong>: If user emails correspond to <a href="mailto:NetID@university.edu">NetID@university.edu</a>, the network manager can specify the email domain used in order to generate accurate user emails. If this field is empty, the server hostname is used to generate &quot;fake&quot; placeholder email addresses.</li> <li><strong><a href="#bypass-domains-behaviour">Bypass</a></strong>: Bypass the &quot;Limited Email Registrations&quot; and &quot;Banned Email Domains&quot; lists under Network Settings.</li> <li><strong><a href="#forced-redirection-behaviour">Forced redirection</a></strong>: hide the Pressbooks login page and go directly to the insitutions's CAS login page.</li> <li><a href="#customize-button-text"><strong>Customize Button Text</strong>:</a> This field allows network managers to customize the label of the &quot;Connect via CAS&quot; button in the Pressbooks login page. If Forced Redirection is checked, then this field is disabled.</li></ul> <h1 id="details-of-settings-behaviours"><a href="#details-of-settings-behaviours" class="header-anchor">#</a> Details of settings behaviours:</h1> <h3 id="bypass-domains-behaviour"><a href="#bypass-domains-behaviour" class="header-anchor">#</a> <strong>Bypass domains behaviour:</strong></h3> <p>If the Bypass option is <strong>OFF</strong>: Pressbooks' Network settings apply for authorized and banned domains.</p> <p>If the Bypass option is <strong>ON</strong>: The &quot;Limited Email Registrations&quot; and &quot;Banned Email Domains&quot; lists do not apply for CAS logins. Even IF Email domain entered in CAS settings match a Banned Email Domain, user will still be created.</p> <h3 id="forced-redirection-behaviour"><a href="#forced-redirection-behaviour" class="header-anchor">#</a> <strong>Forced Redirection behaviour:</strong></h3> <p>If Forced Redirection is <strong>OFF</strong>, the &quot;Sign In&quot; link from the network website homepage brings the user to the Pressbooks login page, where a &quot;Connect via CAS&quot; button is in the login form. Clicking on this button brings the user to the institution's CAS login page.</p> <p>If Forced Redirection is <strong>ON</strong>, the &quot;Sign In&quot; link brings the user directly to the institution's CAS login page.</p> <h3 id="add-new-user-refuse-access-behaviour"><a href="#add-new-user-refuse-access-behaviour" class="header-anchor">#</a> <strong>Add New User / Refuse Access behaviour:</strong></h3> <ol><li><ol><li><p>IF no Pressbooks user exists for this CAS user</p> <ul><li><p>IF CAS is configured to &quot;Add New User&quot; AND CAS login is successful</p> <ul><li><p>a Pressbooks user is created with username = NetID and email = NetID@emailDomain</p></li> <li><p>user logs into Pressbooks successfully</p></li> <li><p>IF CAS is configured to &quot;Refuse Access&quot; AND CAS login is successful</p></li> <li><p>an &quot;Unable to log in&quot; error message appears in the Pressbooks login form (if Forced Redirection is OFF) or in its own page (if Forced Redirection is ON)</p> <p><strong>NOTE</strong>: Once the user has had this error, subsequent clicks on &quot;Connect via CAS&quot; in the login form directly generates the error message, as the user here is already authenticated in CAS. Every time they clicks &quot;Connect via CAS&quot;, CAS recognizes them as authenticated, but Pressbooks is refusing access. To log out, the user must either go to the CAS logout page or close the browser, terminating the CAS session.</p></li></ul></li> <li><p>IF there is an existing Pressbooks user for this CAS user</p> <ul><li>(Whether CAS is configured to &quot;Add new User&quot; or &quot;Refuse access&quot;)</li> <li>User logs into Pressbooks successfully</li></ul></li></ul></li></ol></li></ol> <h3 id="customize-button-text"><a href="#customize-button-text" class="header-anchor">#</a> Customize Button Text</h3> <p>The button can accept multiple lines of text. Add a <code>&lt;br /&gt;</code> tag in the button text to insert a line break.</p> <h1 id="user-identification-mechanism"><a href="#user-identification-mechanism" class="header-anchor">#</a> User identification mechanism</h1> <p>When a user logs into Pressbooks via CAS, the CAS plugin will attempt to find an existing user corresponding to the user who is logging in. If it does not find the user, the CAS plugin will either create a new user (if the CAS setting is set to &quot;Create new user&quot;) or refuse access (if the CAS setting is set to &quot;Refuse access&quot;).</p> <p>The mechanism to match the CAS user with the Pressbooks user is the following:</p> <ol><li>Plugin tries to find a user <code>where wp_usermeta.meta_key = pressbooks_cas_identity and wp_usermeta.meta_value = NETID</code> <ul><li>Where <code>NETID</code> is unique key sent by CAS</li> <li>This allows us to, if we wanted to, manually assign any NETID to any user with an imaginary mass import script, a new doesn't yet exist interface, etc.</li></ul></li> <li>If NETID is not found, try to match a user by their email.
<ul><li>Because CAS doesn't send us the user email, it only sends a <code>NETID</code>, we make up an email using either: <code>NETID@CAS-OPTIONS-{Email Domain}</code>, or if that Admin Option is empty: <code>NETID@{noreply.}CAS-OPTIONS-{Server Hostname}</code></li> <li>wp_usermeta.meta_key and wp_usermeta.meta_value are set by the CAS plugin upon first user matching; subsequent logins follow case #1 above.</li></ul></li> <li>If neither #1 or #2 are found, create a new user.
<ul><li><code>wp_usermeta.meta_key</code> and <code>wp_usermeta.meta_value</code> are set by the CAS plugin upon user creation; subsequent logins follow case #1 above.</li></ul></li></ol> <p>For network admins creating new users in Pressbooks, this means that they need to use the correct user email address so the CAS plugin can properly match the users logging in via CAS and manually-created Pressbooks users.</p> <p>Note: the username is not used for matching purposes.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.05922f2d.js" defer></script><script src="/assets/js/2.6bc8cb11.js" defer></script><script src="/assets/js/8.32271d86.js" defer></script>
  </body>
</html>
